# 地图定位工具

基于 OpenStreetMap 和 Three.js 实现的交互式地图定位工具，支持地址搜索、坐标定位、3D 模型渲染、测距功能和区域创建功能。

## 功能特性

### 1. 地图定位功能

-   **坐标定位**：输入经纬度坐标直接定位到指定位置
-   **地址搜索**：输入地址进行地理编码搜索并自动定位
-   **地图点击**：单击地图任意位置添加标记点并自动更新坐标
-   **智能交互**：支持回车键快速定位，智能区分点击和拖拽操作

### 2. 地图服务

-   **多图层支持**：OpenStreetMap、卫星影像、地形图、街道图
-   **图层切换**：右上角图层控件，支持实时切换不同地图类型
-   **缩放控制**：支持鼠标滚轮缩放，显示当前缩放级别
-   **比例尺**：左下角显示地图比例尺

### 3. 3D 模型渲染

-   **GLB 模型加载**：支持加载 GLB 格式的 3D 模型
-   **地理坐标绑定**：模型位置与地图坐标精确对应
-   **智能缩放**：基于真实地理距离自动调整模型大小
-   **多模型管理**：支持同时加载多个模型，独立管理

### 4. 测距功能

-   **多点测距**：支持添加多个测距点进行连续测距
-   **精确计算**：使用 Turf.js 进行精确的地理距离计算
-   **可视化显示**：测距点用蓝色圆点标记，连线用虚线显示
-   **距离标签**：在线条中间显示每段距离的具体数值
-   **实时反馈**：显示总距离，支持清除测距结果

### 5. 区域创建功能

-   **精确区域**：创建 188m × 188m 的正方形区域
-   **中心对齐**：区域中心点与指定坐标完全重合
-   **可视化样式**：透明蓝色背景，蓝色边框
-   **信息显示**：点击区域可查看中心点坐标和尺寸信息

### 6. 用户体验

-   **现代化 UI**：基于 Element UI 的美观界面
-   **响应式设计**：适配不同屏幕尺寸
-   **操作反馈**：加载状态、成功/错误提示
-   **实时更新**：地图移动时 3D 模型位置同步更新

## 技术栈

-   **Vue.js 2.x** - 前端框架
-   **Element UI** - UI 组件库
-   **Leaflet** - 开源地图库
-   **OpenStreetMap** - 免费开源地图服务
-   **Three.js** - 3D 图形渲染引擎
-   **GLTFLoader** - 3D 模型加载器
-   **Turf.js** - 地理空间分析库

## 使用方法

### 1. 直接运行

直接在浏览器中打开 `index.html` 文件即可使用，无需额外配置。

### 2. 坐标定位

1. 在左侧控制面板输入经纬度坐标
2. 点击"定位到坐标"按钮或按回车键
3. 地图会自动定位到指定坐标并添加标记点

### 3. 地址搜索

1. 在"地址"输入框中输入要搜索的地址
2. 点击搜索按钮或按回车键
3. 系统会自动搜索并定位到该地址

### 4. 地图交互

-   **点击定位**：直接点击地图任意位置添加标记点
-   **拖拽地图**：鼠标拖拽移动地图视图
-   **缩放地图**：鼠标滚轮或使用缩放控件

### 5. 3D 模型操作

1. 选择坐标位置后点击"加载 3D 模型"按钮
2. 系统会在当前坐标加载 GLB 模型
3. 在右侧"3D 模型列表"中可以管理已加载的模型
4. 支持删除单个模型或清除所有模型

### 6. 测距功能

1. 点击"开始测距"按钮进入测距模式
2. 在地图上点击要测量的起点
3. 继续点击添加更多测距点
4. 系统会自动计算并显示各段距离和总距离
5. 点击"结束测距"或"清除测距"退出测距模式

### 7. 区域创建

1. 在经纬度输入框中输入目标坐标，或点击地图选择位置
2. 点击"创建 188mx188m 区域"按钮
3. 系统会在指定坐标创建一个 188m×188m 的正方形区域
4. 点击区域可查看详细信息
5. 再次点击按钮会清除旧区域并创建新区域

## 主要功能说明

### 坐标验证

-   经度范围：-180 到 180
-   纬度范围：-90 到 90
-   自动修正超出范围的坐标值

### 地址搜索

使用 Nominatim 地理编码服务进行地址搜索，支持全球地址查询。

### 3D 模型特性

-   **地理绑定**：模型位置与地图坐标精确对应
-   **智能缩放**：基于地图缩放级别和距离中心点的距离自动调整大小
-   **实时更新**：地图移动或缩放时模型位置和大小同步更新
-   **透明背景**：3D 渲染层透明，不影响地图显示

### 测距功能特性

-   **精确计算**：使用 Turf.js 进行高精度地理距离计算
-   **多点支持**：支持添加多个测距点进行连续测距
-   **可视化**：测距点用蓝色圆点标记，连线用虚线显示
-   **距离标签**：在线条中间显示每段距离的具体数值
-   **实时更新**：显示总距离，支持清除测距结果

### 区域创建特性

-   **精确尺寸**：188m × 188m 的正方形区域
-   **中心对齐**：区域中心点与指定坐标完全重合
-   **地理计算**：考虑地球曲率进行精确的坐标转换
-   **可视化样式**：透明蓝色背景，蓝色边框

### 地图图层

-   **OpenStreetMap**：标准街道地图
-   **卫星影像**：高分辨率卫星图像
-   **地形图**：地形等高线图
-   **街道图**：详细街道信息图

## 配置说明

### 修改默认坐标

在 Vue 实例的 data 中修改默认坐标：

```javascript
form: {
    lng: '101.6869',  // 默认经度
    lat: '3.1390'     // 默认纬度
}
```

### 修改 3D 模型 URL

修改 `glbTemUrl` 变量来使用不同的 3D 模型：

```javascript
glbTemUrl: 'https://your-model-url.glb'
```

### 地图初始化配置

在 `initMap` 方法中可以修改地图的初始配置：

```javascript
this.map = L.map('map-container', {
    zoomControl: false, // 禁用默认缩放控件
}).setView([lat, lng], 12) // 设置初始位置和缩放级别
```

## 浏览器兼容性

-   Chrome 60+
-   Firefox 55+
-   Safari 12+
-   Edge 79+

## 注意事项

1. **网络连接**：需要稳定的网络连接来加载地图服务和 3D 模型
2. **3D 性能**：3D 模型渲染对硬件有一定要求，建议使用支持 WebGL 的现代浏览器
3. **模型加载**：大型 3D 模型可能需要较长的加载时间
4. **内存使用**：加载多个 3D 模型会增加内存使用量
5. **测距精度**：测距功能基于地理坐标计算，精度取决于地图服务的准确性
6. **区域创建**：区域创建功能考虑了地球曲率，在不同纬度下会有轻微的形状变化

## 许可证

本项目仅供学习和参考使用。地图数据来自 OpenStreetMap，遵循 ODbL 许可证。
